<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title data-key="events_page_html_title">City Events Guide - All Events</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="container-fluid p-0">

    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="index.html">
                    <img src="images/cityevents-logo.png" alt="City Events Guide Logo" height="100" class="d-inline-block align-text-top me-2">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="index.html" data-key="nav_home">Home</a></li>
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="events.html" data-key="nav_events">Events</a></li>
                        <li class="nav-item"><a class="nav-link" href="about.html" data-key="nav_about">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="contact.html" data-key="nav_contact">Contact</a></li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="lang-switcher">EN/AR</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="container my-5 py-3">
            <h1 class="display-3 text-primary mb-5" data-key="events_page_title">All City Events</h1>
            
            <div class="row g-4">
                
                <div class="col-lg-3">
                    <div class="card p-3 sticky-top" style="top: 20px;">
                        <h5 class="card-title mb-3" data-key="filter_category_title">Filter by Category</h5>
                        <div class="mb-3">
                            <label for="eventCategory" class="form-label" data-key="filter_category_title">Filter by Category:</label>
                            <select class="form-select" id="eventCategory">
                                <option value="all" data-key="category_all">All Categories</option>
                                <option value="music" data-key="category_music">Music</option>
                                <option value="culture" data-key="category_arts">Arts & Culture</option>
                                <option value="food" data-key="category_food">Food & Drink</option>
                                <option value="sports" data-key="category_sports">Sport</option>
                                <option value="family" data-key="filter_family">Family</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="eventDate" class="form-label" data-key="filter_date_title">Filter by Date:</label>
                            <input type="date" class="form-control" id="eventDate">
                        </div>
                        <div class="mb-3">
                            <label for="eventSearch" class="form-label" data-key="filter_search_label">Search:</label>
                            <input type="text" class="form-control" id="eventSearch" data-key="search_placeholder" placeholder="Search by Event Name or Location...">
                        </div>
                        <button id="applyFilters" class="btn btn-warning w-100 mt-2 mb-3" data-key="filter_apply">Apply Filters</button>
                        </div>
                </div>

                <div class="col-lg-9">
                    <div class="row" id="eventsList">
                        
                        </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-white text-center py-3 mt-5">
        <div class="container">
             <p class="mb-1" data-key="footer_rights">&copy; 2025 City Events Guide. All rights reserved.</p>
        
             <p class="mb-1">
                 <span data-key="footer_contact_text">Contact us:</span>
                 <a href="mailto:info@cityevents.com" class="text-info">info@cityevents.com</a>
             </p>
        
             <p>
                 <span data-key="footer_follow_text">Follow us:</span>
                 <a href="#" class="text-info me-2">Facebook</a>|
                 <a href="#" class="text-info me-2">Twitter</a>|
                 <a href="#" class="text-info">Instagram</a>
             </p>
        </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
        crossorigin="anonymous"></script>

    <script src="js/localization.js"></script>
    <script src="js/eventData.js"></script>
    <script src="js/filter.js"></script> 
    <script>document.addEventListener('DOMContentLoaded', initializeLanguage);</script>

    <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="eventModalLabel"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="eventModalBody"></div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    const eventsList = document.getElementById('eventsList');
    const categoryFilter = document.getElementById('eventCategory');
    const dateFilter = document.getElementById('eventDate');
    const searchInput = document.getElementById('eventSearch');
    const applyBtn = document.getElementById('applyFilters');

    if (!eventsList || typeof events === 'undefined') return;

    function getUrlParametersAndApply() {
        const urlParams = new URLSearchParams(window.location.search);
        
        const urlCategory = urlParams.get('category');
        if (urlCategory) {
            if (categoryFilter) categoryFilter.value = urlCategory;
        }

        const urlDate = urlParams.get('date');
        if (urlDate) {
  
            if (dateFilter) dateFilter.value = urlDate;
        }
        
        const urlSearch = urlParams.get('search');
        if (urlSearch) {
       
            if (searchInput) searchInput.value = urlSearch;
        }
    }

    function renderEvents(filteredEvents) {
        const lang = localStorage.getItem('lang') || 'en';

        eventsList.innerHTML = '';
        
        if (filteredEvents.length === 0) {
            const notFound = document.createElement('div');
            notFound.setAttribute('data-key', 'no_events_found');
            notFound.textContent = "No events found."; 
            notFound.className = "alert alert-warning text-center col-12 mt-5";
            eventsList.appendChild(notFound);
            
            if (typeof translatePage === 'function') {
                translatePage(lang);
            }
            return;
        }

        filteredEvents.forEach(event => {
            const col = document.createElement('div');
            col.className = 'col-12 event-item mb-4';
            col.setAttribute('data-category', event.category);
            col.setAttribute('data-date', event.date);

            const eventTitle = event.title[lang] || event.title.en;
            const eventDescription = event.description[lang] || event.description.en;
            const eventLocation = event.location[lang] || event.location.en;

            col.innerHTML = `
                <div class="card">
                    <div class="row g-0">
                        <div class="col-md-4">
                            <img src="${event.image}" class="img-fluid rounded-start h-100" alt="${eventTitle}" style="object-fit: cover;">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <h5 class="card-title">${eventTitle}</h5>
                                <p class="card-text text-muted">${eventDescription}</p>
                                <div class="card-text">
                                    <div class="d-flex justify-content-start align-items-center mb-1">
                                        <small class="text-danger me-1" data-key="card_date">üóìÔ∏è Date:</small>
                                        <small class="text-danger">${new Date(event.date).toLocaleDateString(lang === 'ar' ? 'ar-EG' : 'en-US')}</small>
                                    </div>
                                    <div class="d-flex justify-content-start align-items-center mb-1">
                                        <small class="text-primary me-1" data-key="card_location">üìç Location:</small>
                                        <small class="text-primary">${eventLocation}</small>
                                    </div>
                                </div>
                                <a href="details.html?id=${event.id}" class="btn btn-sm btn-outline-primary" data-key="view_details_button">View Details</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            eventsList.appendChild(col);
        });
        
        if (typeof translatePage === 'function') {
            translatePage(lang);
        }
    }

    function applyFilters() {
        let filtered = events;
 
        const category = categoryFilter.value;
        const date = dateFilter.value;
        const search = searchInput.value; 

        if (category !== 'all') filtered = filtered.filter(e => e.rawCategory === category);
        if (date) filtered = filtered.filter(e => e.date === date);
        
        if (search) {
            const searchLower = search.toLowerCase();
            filtered = filtered.filter(e => 
                (e.title.en && e.title.en.toLowerCase().includes(searchLower)) ||
                (e.title.ar && e.title.ar.toLowerCase().includes(searchLower)) ||
                (e.location.en && e.location.en.toLowerCase().includes(searchLower)) ||
                (e.location.ar && e.location.ar.toLowerCase().includes(searchLower))
            );
        }

        renderEvents(filtered);
    }
    

    getUrlParametersAndApply();


    applyFilters(); 
    
    applyBtn.addEventListener('click', applyFilters);
    

    document.addEventListener('languageChanged', () => {

        applyFilters(); 
    });
});
</script>

</body>
</html>

